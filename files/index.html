<head>

    <script type="module" src="https://b3008.github.io/executable_HTML/dist/paper-polymer.js"></script>
    <script type="module" src="https://b3008.github.io/executable_HTML/dist/aaCustomElements.js"></script>


    <style>
        #menu {
            border: solid thick;
        }
    </style>
</head>

<body>

    <select id='menu'></select>

    <div id="citationContent"></div>

</body>


<script>

    let myFetch = (url) => {
        return new Promise((resolve, reject) => {
            fetch(url).then(response => response.json()).then(data => {
                resolve(data);
            }).catch((error) => {
                reject(error);
            }).catch(error => {
                reject(error);
            })
        })
    }



    let menu = document.querySelector("#menu");
    let content = document.querySelector("#citationContent");

    myFetch("/citations").then(result => {
        console.log(result);
        let options = "";
        for (let i = 2; i < result.length; i++) {
            options += `<option value='${i}'>${i}. ${result[i]}</option>`

        }
        menu.innerHTML = options;

        menu.addEventListener("change", (val) => {
            console.log(val);
            console.log(menu.value)
            myFetch(`/citations/${menu.value}`).then((result) => {

                console.log(result);
                content.innerHTML += '<div> doi: '+ result.doi + '</div>';
                if (result.doi) {
                
                    console.log(result.doi);
                    myFetch(`/citations/${menu.value}/bib`).then((bib) => {
                        let paperInfo = `
                        <div class="title"> ${bib.entries[0].Fields.title} </div>
                    `
                        content.innerHTML += paperInfo;
                    })
                }
            })
        })
    })


</script>